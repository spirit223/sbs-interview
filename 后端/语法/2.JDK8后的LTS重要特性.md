> ASK
> JDK8后的LTS版本都有哪些重要的新特性

JDK 8 之后的长期支持版本主要有 **JDK 11、JDK 17 和 JDK 21**。每个LTS版本都引入了许多重要的新特性和改进，以下是一些关键点：

# 1. JDK 11 (LTS)

- **HTTP Client (Standard):** 将之前在 `java.net.http` 模块中孵化的 HTTP/2 和 WebSocket 客户端 API 标准化。这是一个现代、支持异步/同步、更易用且功能强大的替代品，取代了陈旧的 `HttpURLConnection`。
- **局部变量类型推断增强 (`var`):** 虽然 `var` 在 JDK 10 引入，但作为第一个 LTS 版本，JDK 11 是其被广泛采用和推广的起点。它允许在局部变量声明时省略显式类型（由编译器推断），减少样板代码。
- 新的垃圾收集器:
  - **Epsilon GC:** 一个无操作的垃圾收集器，仅进行内存分配，不进行回收。主要用于性能测试、极短生命周期的应用或需要完全控制内存管理的场景。
  - **ZGC (Experimental):** 一个可扩展的低延迟垃圾收集器，设计目标是将 GC 停顿时间控制在 **10ms** 以内，且停顿时间不会随堆大小或活动对象集的增长而显著增加。这是为大型堆和低延迟需求应用准备的革命性特性。
- **飞行记录器 (JFR) 开源:** 之前是商业特性，JDK 11 将其开源，成为 OpenJDK 的一部分，使所有开发者都能免费使用这个强大的低开销性能监控和诊断工具。
- **启动单文件源代码程序:** 可以直接运行单个 `.java` 源文件（无需先显式编译成 `.class`），简化了小型程序或脚本的测试和执行 (`java HelloWorld.java`)。
- **String API 增强:** 添加了 `isBlank()`, `lines()`, `repeat(int)`, `strip()`, `stripLeading()`, `stripTrailing()` 等实用方法。
- **移除项:** 移除了 Java EE 和 CORBA 模块（需要的话需单独引入）、移除了 Nashorn JavaScript 引擎、移除了 `javah` 工具等。

# 2. JDK 17 (LTS) - 当前最广泛使用的 LTS

- **密封类 (Sealed Classes):** 允许类或接口的作者精确控制哪些其他类或接口可以扩展或实现它。这是对继承/实现模型的重大增强，增强了领域建模能力，是实现**代数数据类型**的关键。
- 模式匹配 (Pattern Matching) 增强:
  - **`switch` 表达式 (Standard):** 在 JDK 12-14 中预览，JDK 14 二次预览，最终在 JDK 14 标准化（但 JDK 17 LTS 是其稳定落地的里程碑）。允许 `switch` 作为表达式使用（有返回值），支持箭头语法 (`->`)，避免 `break`，并且可以处理 `null`。
  - **`instanceof` 模式匹配 (Standard):** 在 JDK 14 预览，JDK 16 标准化。简化了 `instanceof` 检查后的类型转换，将检查和转换合并为一步。
- **文本块 (Text Blocks) (Standard):** 在 JDK 13-15 中预览，JDK 15 二次预览，最终在 JDK 15 标准化。提供了一种更清晰、更易读的方式来编写多行字符串字面量，自动处理缩进和换行符，极大改善了 JSON、SQL、HTML 等嵌入代码的可读性和可维护性。
- **记录类 (Records) (Standard):** 在 JDK 14-15 中预览，JDK 16 标准化。提供了一种简洁的语法来声明**不可变的数据载体类**。编译器会自动生成构造函数、`equals()`、`hashCode()`、`toString()` 等方法，大幅减少样板代码。
- **强封装 JDK 内部 API:** 默认情况下，强烈封装所有内部元素（除了关键的 `sun.misc.Unsafe` 等），阻止反射访问。需要使用 `--add-opens` 显式打开包。这提高了安全性和可维护性，但也可能影响依赖内部 API 的旧库。
- **新的 macOS 渲染管道:** 使用 Apple Metal API 替代了已弃用的 OpenGL API，为 macOS 提供了更好的图形性能。
- **移除项:** 移除了实验性的 AOT 和 Graal JIT 编译器、移除了 Applet API (早已弃用)、标记了安全管理器 (Security Manager) 为弃用以备将来移除。

# 3. JDK 21 (LTS) - 最新 LTS (2023年9月发布)

- **虚拟线程 (Virtual Threads) (Standard):** 在 JDK 19-20 中预览，JDK 21 标准化。这是 **Project Loom** 的核心成果，旨在显著简化并发编程。虚拟线程是轻量级线程，由 JVM 管理，而非操作系统内核。它们允许以简单的同步阻塞风格编写高吞吐量的并发应用程序（每个请求一个虚拟线程），而无需复杂的异步编程或担心线程池大小限制。这是近些年 Java 最重要的创新之一。
- **结构化并发 (Structured Concurrency) (Preview):** 在 JDK 19-20 中孵化，JDK 21 进入预览。提供了一套 API，将多个在不同线程中运行的任务视为一个工作单元。这简化了错误处理、取消操作，并提高了可靠性和可观察性，减少了线程泄漏和取消延迟的风险。与虚拟线程结合使用效果更佳。
- **记录模式 (Record Patterns) (Standard):** 在 JDK 19-20 中预览，JDK 21 标准化。扩展了模式匹配，允许在 `instanceof` 和 `switch` 中解构记录 (`record`) 对象，方便地提取其组件值。增强了与记录类的配合。
- **模式匹配 `switch` 增强 (Pattern Matching for switch) (Standard):** 在 JDK 17-20 中预览，JDK 21 标准化。允许在 `switch` 的分支中使用类型模式，并支持 `null` 处理。这是模式匹配在 `switch` 上的最终形态。
- **分代 ZGC (Generational ZGC):** 通过将堆划分为新生代和老年代，显著提高了垃圾收集的效率，减少了年轻对象的回收开销，提升了应用程序的整体性能。
- **字符串模板 (预览):** 提供了一种更安全、更便捷的字符串插值方式，比传统的字符串拼接或 `String.format()` 更易读、更安全（防止注入攻击），并且允许自定义模板处理器。
- **作用域值 (预览):** 在 JDK 20 中预览。作为 `ThreadLocal` 的现代替代品，特别适合与虚拟线程一起使用。它提供了一种更可控、更高效的方式来在线程（或虚拟线程）之间共享不可变数据。

# 总结回答要点

- **明确 LTS 版本：** JDK 11, 17, 21。
- 突出每个版本最具标志性和影响力的特性：
  - **JDK 11:** HTTP Client, `var`, ZGC/Epsilon GC, JFR 开源。
  - **JDK 17:** 密封类、记录类、文本块、模式匹配 (`switch` 表达式, `instanceof`)、强封装。
  - **JDK 21:** **虚拟线程 (核心重点)**、结构化并发、记录模式、分代 ZGC。
- **强调标准化过程：** 对于在多个版本中预览后才标准化的特性（如文本块、记录类、模式匹配、虚拟线程），可以提一下它们的演进过程，表明对 Java 发展路线的了解。
- **结合实际价值：** 简要说明这些特性带来的好处（如简化代码、提高性能、增强并发能力、改进安全性等）。
- **提及移除/弃用：** 了解主要的移除项（如 Java EE 模块、Applet API、强封装影响）也体现了对版本变迁的熟悉。

